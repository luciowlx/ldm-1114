# 说明文档（项目全生命周期）

> 本文档用于项目规划、实施方案与进度记录的统一管理；每次启动开发前需先阅读并确认当前进度与要求。

## 一、项目规划
- 目标：构建数据管理原型，支持数据上传、数据预处理（选择数据集→字段选择→规则配置）等关键流程的前端演示。
- 范围：仅前端模拟数据，不涉及后端；需保持各步骤之间字段一致性。
- 时间：以当日迭代为单位，严格按节点推进，发现风险需及时记录并调整计划。

## 二、实施方案
- 技术栈：Mac 开发环境；React + TypeScript + Vite；组件位于 `src/components/*`；统一风格与代码注释规范。
- 流程：按六阶段（Align→Architect→Atomize→Approve→Automate→Assess）推进；测试优先、文档同步。
- 安全：敏感信息使用 `.env` 管理（当前迭代仅前端原型，无后端密钥）。

## 三、进度记录（按节点）
- 2025-11-11：数据上传弹窗 UI 精简
  - 变更：删除顶部对话框描述文字与拖拽区域相同说明文字，简化界面。
  - 文件：`src/components/DataUpload.tsx`
  - 验收：在 `http://localhost:3000/` 预览，交互正常无报错。

- 2025-11-11：数据预处理-字段选择（多数据集）允许修改
  - 需求：当步骤一选择多个数据集时，字段选择步骤展示的聚合字段允许修改（至少字段名与类型）。
  - 变更：在 `src/components/DataPreprocessing.tsx` 新增多源编辑态与校验状态（`aggFieldNameEditValues/Errors`、`aggDuplicateNameSet/hasAnyAggNameError`），启用 Input/Select 控件，完善校验与下一步按钮禁用逻辑；保持 UI 与单源一致。
  - 验收要点：
    1) 多源场景下 Input/Select 可用；
    2) 空值与重复名有行内提示并阻断下一步；
    3) 类型修改正常；
    4) 至少勾选 1 个字段且无错误时可进入规则配置；
    5) 预览在 `http://localhost:3000/` 通过，无控制台错误。
  - 文档：新增 `docs/字段选择可修改/*`（ALIGNMENT/CONSENSUS/DESIGN/TASK/ACCEPTANCE）。

- 2025-11-11：数据预处理-规则配置新增「数据合并」
  - 需求：支持在清洗规则中新增 `data_merge` 类型；主/从数据集与版本只读展示；多行字段映射；合并方式必选（Inner/Left/Outer）；类型兼容与重复校验；任一启用的合并规则不合法时禁用「开始执行数据处理」。
  - 变更：
    1) 扩展 `CleaningRule` 的 `type` 枚举与 `updateCleaningRule` 初始化默认配置；
    2) 规则类型下拉新增「数据合并」，并隐藏单字段选择控件；
    3) 新增合并面板 UI（主/从只读、多行映射增删与行内错误、合并方式选择、统一提示）；
    4) 在提交按钮的 `disabled` 条件中增加对启用 `data_merge` 规则的合法性校验。
  - 文件：`src/components/DataPreprocessing.tsx`
  - 验收要点：
    1) 映射为空/重复/类型不兼容/未选合并方式 → 按钮禁用且提示；
    2) 修正后按钮可用；
    3) 三种合并方式选择均正常；
    4) 控制台无错误。
  - 文档：新增 `docs/数据合并规则/*`（ALIGNMENT/CONSENSUS/DESIGN/TASK/ACCEPTANCE）。

- 2025-11-11：数据预处理-数据合并改造为「公共字段选择」
  - 需求变更：将原“多行主/从字段映射”改为“单一公共字段”下拉选择；候选项为主/从字段名交集，且类型兼容（相同或 文本↔分类）。合并方式仍必选。
  - 变更：
    1) 更新 `CleaningRule` 的配置为 `{ commonField, joinType }`，移除 `mappings`；
    2) 改造 UI：只保留公共字段下拉与合并方式选择；当无公共字段时提示并禁用；
    3) 更新全局提交禁用逻辑：未选择有效公共字段或未选合并方式时禁用；
    4) 更新面板“校验规则”文案为公共字段说明与缺失处理策略。
  - 文件：`src/components/DataPreprocessing.tsx`
  - 验收要点：
    1) 公共字段必须存在于主/从两侧且类型兼容；
    2) 三种合并方式选择均正常；
    3) 无公共字段时展示提示并禁用提交；
    4) 控制台无错误；本地预览地址 `http://localhost:3000/`。
  - 文档：已同步更新 `docs/数据合并规则/*`（ALIGNMENT/CONSENSUS/DESIGN/TASK/ACCEPTANCE）。

## 四、风险与后续计划
- 风险：未来若引入后端需定义跨源字段名/类型的持久化与冲突解决策略。
- 下一步建议：
  - 在规则配置（Step 2）中同步展示用户修改后的聚合字段名与类型，确保一致；
  - 增加批量重命名或类型统一的便捷操作（原型阶段可暂缓）。